pico-8 cartridge // http://www.pico-8.com
version 36
__lua__
-- game loop --

function _init()
	map_setup()
	make_player()
end

function _update()
	move_player()
end

function _draw()
	cls()
	draw_map()
	draw_player()
	print('mapx:'..mapx, player.x*8,0,8)
	print('playerx: '..player.x)
end

function swap_tile(x,y)
	tile=mget(x,y) -- return sprite number assigned to map cell at x,y
	-- change sprite number at x,y to the sprite immediately after mget x,y
	-- e.g. +1 would swap sprite 041 with 042
	mset(x,y,tile+1)
end

function get_key(x,y)
	-- 
	player.keys+=1
	swap_tile(x,y)
	sfx(1)
end

-- map code --

function map_setup()
	-- map tile settings: this is the coloured dots in sprite part of IDE
	wall=0
	key=1
	door=2
	anim1=3
	anim2=4
	lose=6
	win=7
end

function draw_map()
	camera_follow()
	map(0,0,0,0,128,64)	
end

function camera_follow()
	-- map tiles are 8*8
	-- dont move if player in the first map tile (the -8) or after x 111
 mapx=mid(0,player.x-8,111)
 mapy=mid(0,player.y-8,47)
 camera(mapx*8,mapy*8)
end

function is_tile(tile_type,x,y)
	-- mget returns sprite number
	tile=mget(x,y)
	-- sprite flagged?
	-- returns true/false
	has_flag=fget(tile,tile_type)
	return has_flag
end

function can_move(x,y)
	-- the not here reverses the value returned
	-- i think, so false becomes true
	return not is_tile(wall,x,y)	
end

-- player code

function make_player()
	-- table
	player={}
	player.x=5
	player.y=3
	player.sprite=68
	player.keys=0
end

function move_player()
	newx=player.x
	newy=player.y
	
	if (btnp(⬅️)) newx-=1
	if (btnp(➡️)) newx+=1
	if (btnp(⬆️)) newy-=1
	if (btnp(⬇️)) newy+=1
	
	interact(newx,newy)
	
	if (can_move(newx,newy)) then
		-- move player within screen
		player.x = mid(0,newx,127)
		player.y = mid(0,newy,63)
	else -- if cant move		 
		sfx(0)
	end
end

function draw_player()
	-- which sprite, x/y coords * 8 (map tiles are 8x8)
	spr(player.sprite,player.x*8, player.y*8)
end

function interact(x,y)
	if (is_tile(key,x,y)) then
		get_key(x,y)
	end
end
__gfx__
00000000bbbbb333333bbbbb333bb3b133ab1333bbbbbbbbbbbbb9bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb4444bbbbbbbbbbbbbbbbb33bbb
00000000bbbb33333333bbbb33331133b3113333bbbbbbbbbbbb9bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb44999944bbbbbbbbbbbbbb31b3bb
00700700bbb3a3baab333bbbab3331133133a3babb224444444944bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb4494aaa94944bbbbbbbbbbb33b331b
00077000bb3b3baaaab133bbaab13331333b3baab22229949994944bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb449494aaaa444944bbbbbbbbb13aa33b
00077000b33311baab13b33bab13b331133311bab21222244244224bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb44949444aaa949494944bbbbbb33b5ab33
00700700b3ab333333bb113b33bb113113ab3333b22124442444441bbbbbbbbbbbb33bbbbbbbbbbbbbbbbbbbbbbb4494949494aaaa4949444944bbbb313bb311
00000000b311bb331311333b131133344311bb33b12242122221223bbbbbbbbbb3bb3b3bb33bb3bbbbbbbbbbbb449494949494aaaa494449494944bb13bb1b31
00000000b1b31133333ab31b333ab31111b311333311111111111133bbbbbbbb333bb33333bb333bbbbbbbbb449494449444a444444a4949494449443113b331
bbbbbbbbb31bb3b133ab113b33ab1333333bb3b1bbbbbbbbbbbbbbbbbbbbbbb333333333333333333bbbbbbb2494949494a4442222444a49444949421b333111
bbbbbbbbb1111133b311311bb311333333331133bbbbbbbbbbb3bbbbbbbbbb3333333b33bb33333333bbbbbb44949494a44422111122444a4949494411b3bb11
bbbbbbbbbb11b113313311bb3133a3baab333113bbbb88bbb33bbbbbbbbbbbb333bb3bb3bb3b33b33bbbbbbb249444a444221111111122444a49444231333313
bbbbbbbbbbb1113133111bbb333b3baaaab13331bbb8f88bbbbb3bbbbbbbb3bb333bbbbbbbbbbbb3bb3bbbbb2494a4442211112222111122444a4942b311113b
bbbbbbbbbbb3111111113bbb133311baab13b331bbb2882bbbbbb33bbbbbb33b3bbbbbbbbbbbbb33b33bbbbb24a44422111122222222111122444a42bb3223bb
bbbbbbbbbb314211112413bb13ab333333bb1131b2bb22bbbb3bbbbbbbbbbbb33bbbbbbbbbbbbbb33bbbbbbb24442211112222244222221111224442bb1442bb
bbbbbbbbb31421244212413b4311bb3313113334b3b3223bbbb3bbbbbbbbbb333bbbbbbbbbbbbb3333bbbbbb2422111122222444444222221111224231434413
bbbbbbbbbb331441144133bb11b31133333ab311bbbb33bbbbbbbbbbbbbbbbb333bbbbbbbbbbb3333bbbbbbb21111122222444444444422222111112b333133b
bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb88bbb33333333bbbbbbb3333bbbbbbbbbbb333bbbbbbb11111222244444444444444222211111bbbbbbbb
bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb8f82bb3b333333bbbbbb333bbbbbbbbbbbbbb333bbbbbbb112122444111144444111444221211bbbbbbbbb
bbbbbdddddddbbbbbbbbbbbbbbbddbbbbbbbddbbbb8882bb33bb3333bbbbbb3b33bbbbbbbbbbbb33b3bbbbbbbb1221444111111444111114441221bbbbbbbbbb
bbbbdd6d666ddbbbbbbbbbbbbdd66dbbbbbd6ddbb8888e2b33333b33bbbbbbbb333bbbbbbbbbb333bbbbbbbbb312242241111114441111142242213bbbbbbbbb
bbbddddddd66ddbbbbbbbbbbd666d55bbbd6dd5bb8f8222b333bb333bbbbbbb333bbbbbbbbbbbbb33bbbbbbbb311244441111914441111144442113bbbbbbbbb
bbdddddddddd6ddbbbbbbbbd66ddd55bb35dd553bb8222bb333333b3bbbbbb333bbbb33b3bbbbb3333bbbbbb3312124441111414442222244421213bbbbbbbbb
bb55dddddd55dddbbbbbbbd66ddd555bbb35553bbb3113bb3bb33b33bbbbbbb333b3bb3b3b3b3b333bbbbbbb3331142241111114444444442241133bbbbbbbbb
b5555ddd66dd555bbbbbbd6ddddd55bbbbbbbbbbb322223b33333333bbbbbbbb3333333333333333bbbbbbbbb333311441111114424224244113333bbbbbbbbb
b55dd5d66dd5155bbbbbdddd5dd551bbbbbbbbbb3333333333333333bbbbbbbb333bb333b33bb333b44bb44b333bb3b133ab1344443bb3b133ab1333bbbbbbbb
b151dddddd55155bbbbdd6dd15555bbbbbbdddbb3333333333333333bbbbb3bbb3bb3b3bbb33bb3b9999999933331133b311449999441133b3113333bbbbbbbb
33151dddd5555133bbbdddddd1551bbbbbdd6ddb3333333333333b33bb333bbbbbb33bbbbbbbbbbb44444444ab333113314494aaa94944133133a3babbbbbbbb
b33111555511133bb331ddd555513333bdddd5db33333333333bbb33b33333bbbbbbbbbbbbbbbbbb42242424aab13331449494aaaa444944333b3baabbbbbbbb
bb333311113333bbbb333111111333bbb5d5555b3333333333bbbbb3b333333bbbbbbbbbbbbbbbbb42422424ab13b344949444aaa9494949443311babbbbbbbb
bbbb33333333bbbbbbbb33333333bbbb335111333333333333bbb333bb3333bbbbbbbbbbbbbbbbbb4444444433bb4494949494aaaa49494449443333bbbbbbbb
bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb3333bb3333333333333333bbbb3bbbbbbbbbbbbbbbbbbbb22bb22b13449494949494aaaa49444949494433bbbbbbbb
bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb3333333333333333bbbbbbbbbbbbbbbbbbbbbbbb32233223449494449444a444444a494949444944bbbbbbbb
3b33333b31111133cccccccccccccccc0002200000000000000000000000000000000000000000000000000000000000000000000000000000000000bbbbbbbb
bb33b3bb11555113cccc7ccccc1111cc0002200000000000000000000000000000000000000000000000000000000000000000000000000000000000bbbbbbbb
b333b33315565551ccccccccc116511c0acaaca000000000000000000000000000000000000000000000000000000000000000000000000000000000bbbbbbbb
333bb33315556551cccccc7cc155651caaccccaa00000000000000000000000000000000000000000000000000000000000000000000000000000000bbbbbbbb
3bb3333b11255551c7ccccccc115551ca0acca0a00000000000000000000000000000000000000000000000000000000000000000000000000000000bbbbbbbb
3b3333b331125211cccccccc6011151c20cccc0200000000000000000000000000000000000000000000000000000000000000000000000000000000bbbbbbbb
bb333bb333112113ccccccccc600111c0033330000000000000000000000000000000000000000000000000000000000000000000000000000000000bbbbbbbb
3333bb3300011133ccccc7ccccc666cc0030030000000000000000000000000000000000000000000000000000000000000000000000000000000000bbbbbbbb
bbbbbbbbbbbbbbbb4a4444a44a4aa4a40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bbbbbbbb
bbbbbbbbbbbbbbbb4a4444a4050990500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bbbbbbbb
aaabbbbbbbbbbbbb4a4444a4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bbbbbddd
abaaaaaabbbbbbbb4a4444a4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bbbbdd6d
ababbababbbbbbbbaaa99aaa050000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bbbddddd
aaabbbbbbbbbbbbb090990904a4444a40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bbdddddd
bbbbbbbbbbbbbbbb4a4444a44a4444a40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bb55dddd
bbbbbbbbbbbbbbbb4a4444a44a4444a40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b5555ddd
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b55dd5d6
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b151dddd
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000033151ddd
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b3311155
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bb333311
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bbbb3333
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bbbbbbbb
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b33333b
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bb33b3bb
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b333b333
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000333bb333
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003bb3333b
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b3333b3
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bb333bb3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003333bb33
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bbbbbbbb
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bbbbbbbb
__gff__
0001010000000000000000010101010100010100000000000000000101010101010101010000000000000001010101000101010100000000000000000000000000000000000000000000000000000000020003010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070707070720210a070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707202107303107500707070707070707070707070707070707070707070720212416240720210707070707070707070707070707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070730312407070707070707072f070707070707072223070707071607070730310720212730310707070707070707070707070707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707070707520707070707070707073233070707070707070707070730312407070707070707070707070707071607070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707010207070707070707070707150707070707070707070707070707070707070707070707071607070707070707070707070707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102111207070707070707070707070715070707070707070707070707070707070707070707070707070707070707070707070707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
111207070b0c0d0e070707070707071507070707070707070707070707070707070707070707070707070707071607070707070707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07070f071b1c1d1e070707070707070707070707070707070707070707070707160707070707070707070707070707070707070707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07071f072b2c2d2e073a07070707070707070707070707071507070707070707070707070707070707070707070707070707070707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707070707070716070707070707070707070707070707071607070707070716070707070707070707070707070707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707070707070707070707070722230707070707070707070707070707070707070707070707070707160707070707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707160707070707070707070707070732330707070707070707070707070707070707070707070707070707070707070707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707070707070707070707150707070707070707070707070707070707070707070707070707070707070707070707160707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707070707070707070707070707070707070707070707070707070707160707070707071607070707070707070707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07070707070707071507070707160707070707070707070707071607070707070f070f160707070707070707070707070707070707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07070707070707070707070707070707070707070707070707070707070707071f071f070707070707070707070707070707070707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707070707070707070707070707070707070707072223070707070707070707070707070707071607070707070707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707070707070707070707070707070707070707073233070707070707070707070707070707070707070707070707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707071607070707070707070707070707150707070707070707070707070707070707070707070707070707070707070707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707070707070707070707070707070707070707070707070707070707070707070707161607070707070707160707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707070707071507070707070707070707070707070707070707070707070707070707071616070707070707070707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707070707070707070707070707070707070707070707070707160707070707071607070707160707070707070707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707070707070707070707222307070707070707070707070707070707070707071607070707071607070707070707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707070707070707070707323307070707070716070707070707070707070707070707070707070707160707070707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000500000d15000000000000000000000001000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000500000000020050240502a0502f0503d0501900018000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
